<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYC Weekly Group Rides</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --primary: #2563eb; --bg: #ffffff; --card: #f8fafc; --text: #0f172a; --border: #e2e8f0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--text); line-height: 1.5; }
        .container { max-width: 700px; margin: 0 auto; }
        
        header { text-align: center; padding: 40px 0; border-bottom: 2px solid var(--border); margin-bottom: 40px; }
        h1 { font-size: 2.5rem; font-weight: 900; letter-spacing: -1px; margin: 0; }
        .subtitle { color: #64748b; font-size: 1.1rem; margin-top: 10px; }

        /* Day Sections */
        .day-section { margin-bottom: 60px; }
        .day-title { font-size: 1.8rem; font-weight: 800; border-bottom: 4px solid var(--primary); display: inline-block; margin-bottom: 25px; padding-right: 20px; }
        
        .ride-list { display: grid; gap: 15px; }
        .ride-card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border); }
        
        .ride-top { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 10px; }
        .ride-name { font-size: 1.25rem; font-weight: 700; margin: 0; color: var(--text); }
        .ride-time { font-weight: 700; color: var(--primary); font-size: 0.95rem; }

        .ride-meta { display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; }
        .tag { font-size: 0.7rem; font-weight: 800; text-transform: uppercase; padding: 3px 8px; border-radius: 4px; background: #e2e8f0; color: #475569; }
        .tag-cat { background: #fee2e2; color: #991b1b; }

        .location { font-size: 0.9rem; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }
        .location a { color: var(--primary); text-decoration: none; font-weight: 600; }
        
        .description { font-size: 0.95rem; color: #334155; margin-bottom: 15px; }

        .links { display: flex; gap: 20px; font-size: 0.85rem; }
        .links a { font-weight: 700; color: var(--primary); text-decoration: none; text-transform: uppercase; letter-spacing: 0.5px; }
        .links a:hover { text-decoration: underline; }

        .no-rides { color: #94a3b8; font-style: italic; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>NYC Group Rides</h1>
        <p class="subtitle">Weekly pacelines and social rolls.</p>
    </header>

    <div id="schedule">
        <p style="text-align: center;">Loading the peloton...</p>
    </div>
</div>

<script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS-eBkGA4ZZs82Yh5e4OtTPLaRUlmAAOSk5YeaCn_iwthbGJvHZ8GGK7Kt6C5LRoRvip-QPv_4B5v3S/pub?gid=0&single=true&output=csv';
    const daysOfWeek = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

    function init() {
        Papa.parse(sheetUrl, {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                const data = results.data.map(row => {
                    const newRow = {};
                    for (let key in row) { newRow[key.trim()] = row[key] ? row[key].trim() : ""; }
                    return newRow;
                });
                renderSchedule(data);
            }
        });
    }

    function renderSchedule(rides) {
        const scheduleContainer = document.getElementById('schedule');
        scheduleContainer.innerHTML = ''; // Clear loading message

        daysOfWeek.forEach(day => {
            const ridesForDay = rides.filter(r => r['Day'] === day);
            
            // Create Section for the Day
            const section = document.createElement('div');
            section.className = 'day-section';
            
            let ridesHtml = ridesForDay.map(r => {
                // Improved link checking: removes accidental spaces and checks for http
                const clubLink = r['Organizer/Club Link'];
                const stravaLink = r['Strava Link'];
                const locLink = r['Start Location Link'];

                return `
                    <div class="ride-card">
                        <div class="ride-top">
                            <h3 class="ride-name">${r['Ride Name']}</h3>
                            <span class="ride-time">${r['Start Time']}</span>
                        </div>
                        <div class="ride-meta">
                            ${r['Category/Speed'] ? `<span class="tag tag-cat">${r['Category/Speed']}</span>` : ''}
                            ${r['Distance'] ? `<span class="tag">${r['Distance']}</span>` : ''}
                        </div>
                        <div class="location">
                            üìç ${locLink ? `<a href="${locLink}" target="_blank">${r['Start Location']} ‚Üó</a>` : r['Start Location']}
                        </div>
                        ${r['Description'] ? `<div class="description">${r['Description']}</div>` : ''}
                        <div class="links">
                            ${clubLink.includes('http') ? `<a href="${clubLink}" target="_blank">Club Info ‚Üó</a>` : ''}
                            ${stravaLink.includes('http') ? `<a href="${stravaLink}" target="_blank">Strava Route ‚Üó</a>` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            section.innerHTML = `
                <h2 class="day-title">${day}</h2>
                <div class="ride-list">
                    ${ridesHtml || '<p class="no-rides">No rides listed for this day yet.</p>'}
                </div>
            `;
            
            scheduleContainer.appendChild(section);
        });
    }

    init();
</script>

</body>
</html>
